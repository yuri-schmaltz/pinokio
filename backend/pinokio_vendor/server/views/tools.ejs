<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <link href="/xterm.min.css" rel="stylesheet" />
  <link href="/css/fontawesome.min.css" rel="stylesheet">
  <link href="/css/solid.min.css" rel="stylesheet">
  <link href="/css/regular.min.css" rel="stylesheet">
  <link href="/css/brands.min.css" rel="stylesheet">
  <link href="/markdown.css" rel="stylesheet" />
  <link href="/noty.css" rel="stylesheet" />
  <link href="/style.css" rel="stylesheet" />
  <link href="/urldropdown.css" rel="stylesheet" />
  <% if (agent==="electron" ) { %>
    <link href="/electron.css" rel="stylesheet" />
    <% } %>
      <style>
        .line2 {
          display: flex;
          align-items: center;
          cursor: pointer;
          background: rgba(0, 0, 100, 0.04);
        }

        .line2 a {
          text-decoration: none;
          color: black;
        }

        .status {
          padding: 10px;
          margin: 10px;
          border-radius: 10px;
        }

        .status.offline {
          background: silver;
        }

        .status.online {
          background: yellowgreen;
        }

        .switch {
          padding: 10px;
          margin: 10px 0;
        }

        .switch[data-online=true] {
          color: yellowgreen;
        }

        .button {
          padding: 10px;
        }

        .on,
        .off {
          display: flex;
          align-items: center;
        }

        /*
.btn {
  margin-right: 5px;
  font-weight: normal;
  padding: 5px 15px;
  min-width: 100px;
  text-align: center;
}
*/
        .items {
          max-width: 600px;
          margin: 50px auto;
        }

        body.dark .item {
          border-left: 5px solid rgba(255, 255, 255, 0.06);
        }

        .item {
          margin: 0;
          /*
  border-top: 1px solid rgba(255,255,255,0.1);
  border-bottom: 1px solid rgba(255,255,255,0.1);
  */
          padding: 10px;
          border-left: 5px solid rgba(0, 0, 0, 0.06);
        }

        .titleview {
          margin: 0;
          padding: 25px;
          max-width: 600px;
        }

        .titleview h1 {
          word-break: break-word;
          font-size: 40px;
          margin-bottom: 10px;
        }

        .item>.d {
          padding-bottom: 10px;
        }

        .item label {
          display: block;
          text-transform: capitalize;
          font-size: 20px;
          font-weight: bold;
          padding-bottom: 5px;
        }

        .item .explanation {
          padding-top: 5px;
          color: #bf411d;
          font-size: 12px;
        }

        .item input[type=text] {
          background: whitesmoke;
        }

        .item select {
          background: whitesmoke;
        }

        /*
body.dark .item input[type=text] {
  background: rgba(255,255,255,0.1);
  color: white;
}
body.dark .item select {
  color: white;
  background: rgba(255,255,255,0.1);
}
*/
        .item input[type=text] {
          padding: 10px;
          flex-grow: 1;
          border: none;
          /*
  background: rgba(0,0,0,0.05);
  */
          width: 100%;
        }

        .item select {
          /*
  -webkit-appearance: none;
  -moz-appearance:    none;
  appearance:         none;
  */

          /*
  background: rgba(0,0,0,0.05);
  */
          padding: 10px;
          box-sizing: border-box;
          width: 100%;
          border: none;
        }

        .item img {
          width: 100px;
        }

        .item .title {
          text-decoration: none;
          color: rgba(127, 91, 243, 0.9);
        }

        .item .col {
          padding: 10px;
        }

        .item .col>* {
          margin: 5px 0;
        }

        .item .stat {
          color: rgba(0, 0, 0, 0.8);
          display: flex;
        }

        .item .stat>* {
          margin-right: 15px;
        }

        .timestamp {
          color: rgba(0, 0, 0, 0.5);
        }

        body.dark .loading {
          background: rgba(255, 255, 255, 0.06);
        }

        .loading {
          padding: 20px;
          text-align: center;
          background: rgba(0, 0, 0, 0.06);
        }

        body.dark .btn {
          color: white;
          background: rgba(255, 255, 255, 0.1);
        }

        body.light {
          /*
  background: var(--light-nav-bg);
  */
        }

        /*
form {
  text-align: center;
}
body.dark header .btn2 {
  color: var(--light-link-color); 
}
header .btn2 {
  color: var(--light-color); 
}
*/
        /*
body.dark header .home {
  color: var(--light-link-color); 
}
*/
        header .home {
          color: var(--light-color);
        }

        body.dark hr {
          background: white;
        }

        hr {
          opacity: 0.03;
          background: black;
          margin: 30px 0;
          height: 1px;
          border: none;
        }

        body.dark .config {
          color: white;
        }

        .config {
          color: black;
          padding: 30px;
          margin: 10px 0;
        }

        .config-header {}

        .config-body {
          padding-top: 20px;
          margin-top: 20px;
        }

        .config .btn {
          font-size: 16px;
          font-weight: bold;
          width: 100px;
          background: rgba(127, 91, 243, 0.9);
          flex-shrink: 0;
        }

        .config-row {
          padding: 10px 20px 0 0;
        }

        .label {
          padding-bottom: 5px;
          font-weight: bold;
        }

        .config-row input[type=text] {
          padding: 7px;
        }

        .header-label {
          padding: 0;
          font-size: 30px;
          text-transform: capitalize;
        }

        body.dark .container {
          color: white;
        }

        .container {}

        .dark .container-row {
          background: rgba(255, 255, 255, 0.04);
        }

        .container-row {
          background: rgba(0, 0, 100, 0.04);
          box-sizing: border-box;
        }

        .header-label-sub h1 {
          font-size: 25px;
          letter-spacing: -1px;
          font-weight: lighter;
        }

        .header-label-sub {
          font-size: 16px;
          padding: 10px 0;
          border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .header-label-sub .s {
          padding: 10px 0;
          opacity: 0.7;
        }

        body.dark .section-header {}

        .section-header {
          font-weight: normal;
          font-size: 14px;
          padding: 15px 5px;
        }

        .section-header h2 {
          font-size: 20px;
          font-weight: lighter;
          margin: 0;
        }

        .section-header .section {
          padding: 0;
        }

        .section-header .section div {
          font-weight: normal;
          opacity: 0.6;
          font-size: 14px;
        }

        .section-header h3 {
          display: flex;
          margin: 0;
        }

        .section-header .col {
          padding-left: 10px;
          flex-grow: 1;
          min-width: 0;
          word-wrap: break-word;
        }

        .tab-content {
          width: 100%;
          display: flex;
          flex-direction: column;
          flex-wrap: wrap;
          gap: 5px;
        }

        .tab:hover {
          color: rgba(127, 91, 243, 0.9);
        }

        .tab-content .tab {
          text-decoration: none;
          display: flex;
          font-size: 14px;
          font-weight: bold;
          color: black;
          overflow: hidden;
          box-sizing: border-box;
          align-items: center;
          gap: 2px;
          background: rgba(0, 0, 0, 0.04);
          border-radius: 5px;
          padding: 5px;
        }

        body.dark .tab {
          color: white;
          background: rgba(255, 255, 255, 0.03);
        }

        .tab h2 {
          margin: 0;
          font-size: 14px;
        }

        .tab .col {
          flex-grow: 1;
          margin-left: 10px;
        }

        .tab .emoji {
          width: 30px;
          height: 30px;
          font-size: 20px;
          box-sizing: border-box;
          text-align: center;
          display: flex;
          justify-content: center;
          align-items: center;
        }

        .tab i.img {
          height: 30px;
          width: 30px;
          display: flex;
          justify-content: center;
          font-size: 20px;
          align-items: center;
          border-radius: 3px;
        }

        .menu-container {
          /*
  max-width: 800px;
  */
          padding: 20px;
          align-items: stretch;
        }

        .menu-container {
          display: flex;
          box-sizing: border-box;
          flex-direction: column;
        }

        .package-tabs {
          display: flex;
          border-bottom: 2px solid rgba(0, 0, 0, 0.1);
          margin-bottom: 20px;
        }

        body.dark .package-tabs {
          border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .package-tab {
          padding: 10px 20px;
          background: rgba(0, 0, 0, 0.04);
          border: none;
          cursor: pointer;
          font-size: 14px;
          font-weight: bold;
          color: rgba(0, 0, 0, 0.7);
          margin-right: 2px;
          border-radius: 5px 5px 0 0;
          transition: all 0.2s ease;
        }

        body.dark .package-tab {
          background: rgba(255, 255, 255, 0.04);
          color: rgba(255, 255, 255, 0.7);
        }

        .package-tab:hover {
          color: rgba(127, 91, 243, 0.9);
          background: rgba(0, 0, 100, 0.08);
        }

        body.dark .package-tab:hover {
          background: rgba(255, 255, 255, 0.08);
        }

        .package-tab.active {
          background: rgba(127, 91, 243, 0.9);
          color: white;
        }

        .package-tab.active:hover {
          background: rgba(127, 91, 243, 0.9);
          color: white;
        }

        .tab-panel {
          display: none;
        }

        .tab-panel.active {
          display: block;
        }

        .bundles-section {
          margin-bottom: 30px;
        }

        .bundles-header {
          padding: 15px 0;
          border-bottom: 1px solid rgba(0, 0, 0, 0.1);
          margin-bottom: 20px;
        }

        body.dark .bundles-header {
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .bundles-header h3 {
          margin: 0;
          font-size: 18px;
          font-weight: lighter;
          color: rgba(0, 0, 0, 0.8);
        }

        body.dark .bundles-header h3 {
          color: rgba(255, 255, 255, 0.8);
        }

        .bundles-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 15px;
        }

        .bundle-card {
          background: rgba(0, 0, 0, 0.04);
          padding: 15px;
          border-left: 4px solid rgba(127, 91, 243, 0.9);
        }

        body.dark .bundle-card {
          background: rgba(255, 255, 255, 0.04);
        }

        .bundle-card.installed {
          border-left-color: #28a745;
        }

        .bundle-card.pending {
          border-left-color: #ffc107;
        }

        .bundle-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 15px;
        }

        .bundle-title-section {
          display: flex;
          align-items: center;
          gap: 10px;
          flex-grow: 1;
        }

        .bundle-icon {
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
          background: rgba(127, 91, 243, 0.9);
          color: white;
          border-radius: 8px;
          font-size: 18px;
          flex-shrink: 0;
        }

        body.dark .bundle-icon {
          background: lightblue;
          color: black;
        }

        .bundle-title-text {
          flex-grow: 1;
        }

        .bundle-name {
          font-size: 16px;
          font-weight: bold;
          color: rgba(127, 91, 243, 0.9);
          margin-bottom: 2px;
        }

        body.dark .bundle-name {
          color: lightblue;
        }

        .bundle-code {
          font-size: 12px;
          color: rgba(0, 0, 0, 0.6);
          font-weight: normal;
        }

        body.dark .bundle-code {
          color: rgba(255, 255, 255, 0.6);
        }

        .bundle-description {
          font-size: 13px;
          color: rgba(0, 0, 0, 0.7);
          margin-bottom: 15px;
          line-height: 1.4;
        }

        body.dark .bundle-description {
          color: rgba(255, 255, 255, 0.7);
        }

        .bundle-status {
          font-size: 12px;
          padding: 3px 8px;
          border-radius: 12px;
          text-transform: uppercase;
          font-weight: bold;
        }

        .bundle-status.installed {
          background: #28a745;
          color: white;
        }

        .bundle-status.pending {
          background: #ffc107;
          color: black;
        }

        .bundle-packages {
          margin-bottom: 15px;
        }

        .bundle-packages-title {
          font-size: 12px;
          font-weight: bold;
          color: rgba(0, 0, 0, 0.6);
          margin-bottom: 5px;
        }

        body.dark .bundle-packages-title {
          color: rgba(255, 255, 255, 0.6);
        }

        .bundle-packages-list {
          display: flex;
          flex-wrap: wrap;
          gap: 5px;
        }

        .package-badge {
          background: rgba(0, 0, 100, 0.1);
          color: rgba(0, 0, 0, 0.8);
          padding: 2px 6px;
          border-radius: 10px;
          font-size: 11px;
          position: relative;
          display: inline-flex;
          align-items: center;
          gap: 3px;
        }

        body.dark .package-badge {
          background: rgba(255, 255, 255, 0.1);
          color: rgba(255, 255, 255, 0.8);
        }

        .package-badge.installed {
          background: rgba(40, 167, 69, 0.2);
          color: #28a745;
          border: 1px solid rgba(40, 167, 69, 0.3);
        }

        body.dark .package-badge.installed {
          background: rgba(40, 167, 69, 0.3);
          color: #4caf50;
          border: 1px solid rgba(40, 167, 69, 0.4);
        }

        .package-badge.not-installed {
          background: rgba(220, 53, 69, 0.2);
          color: #dc3545;
          border: 1px solid rgba(220, 53, 69, 0.3);
        }

        body.dark .package-badge.not-installed {
          background: rgba(220, 53, 69, 0.3);
          color: #f56565;
          border: 1px solid rgba(220, 53, 69, 0.4);
        }

        .package-badge-icon {
          font-size: 8px;
          font-weight: bold;
        }

        .bundle-install-btn {
          background: rgba(127, 91, 243, 0.9);
          color: white;
          border: none;
          padding: 8px 15px;
          border-radius: 5px;
          text-decoration: none;
          display: inline-block;
          font-size: 12px;
          font-weight: bold;
          text-align: center;
          transition: background 0.2s ease;
          width: 100%;
          box-sizing: border-box;
        }

        .bundle-install-btn:hover {
          background: #4169e1;
          color: white;
        }

        .bundle-install-btn.installed {
          background: #28a745;
          cursor: default;
        }

        .bundle-install-btn.installed:hover {
          background: #28a745;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 400px;
          text-align: center;
        }

        .loading-spinner {
          width: 50px;
          height: 50px;
          border: 4px solid rgba(0, 0, 0, 0.1);
          border-left: 4px solid rgba(127, 91, 243, 0.9);
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin-bottom: 20px;
        }

        body.dark .loading-spinner {
          border: 4px solid rgba(255, 255, 255, 0.1);
          border-left: 4px solid lightblue;
        }

        @keyframes spin {
          0% {
            transform: rotate(0deg);
          }

          100% {
            transform: rotate(360deg);
          }
        }

        .loading-text {
          font-size: 16px;
          color: rgba(0, 0, 0, 0.7);
          margin-bottom: 10px;
        }

        body.dark .loading-text {
          color: rgba(255, 255, 255, 0.7);
        }

        .loading-subtext {
          font-size: 14px;
          color: rgba(0, 0, 0, 0.5);
        }

        body.dark .loading-subtext {
          color: rgba(255, 255, 255, 0.5);
        }

        .reset-cache-loading {
          padding: 10px;
          background: rgba(0, 0, 0, 0.1);
          margin-bottom: 10px;
          text-align: center;
        }

        .reset-bin-loading {
          padding: 10px;
          background: rgba(0, 0, 0, 0.1);
          margin-bottom: 10px;
          text-align: center;
        }

        #proxy {
          text-decoration: underline;
          margin-left: 10px;
          display: inline-block;
          cursor: pointer;
        }

        body.dark .keys pre {
          background: rgba(255, 255, 255, 0.02) !important;
        }

        .keys pre {
          padding: 20px;
          margin: 20px 0;
          background: rgba(0, 0, 100, 0.04) !important;
        }

        .swal2-actions {
          justify-content: center !important;
        }

        .swal2-title {
          text-align: center !important;
        }

        .package-install-card {
          background: rgba(0, 0, 0, 0.035);
          border: 1px solid rgba(0, 0, 0, 0.06);
          border-radius: 10px;
          padding: 15px;
          margin-bottom: 20px;
          box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.25);
        }

        body.dark .package-install-card {
          background: rgba(255, 255, 255, 0.05);
          border-color: rgba(255, 255, 255, 0.08);
          box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
        }

        .package-install-form {
          display: flex;
          flex-wrap: wrap;
          gap: 15px;
          align-items: flex-end;
        }

        .package-install-field {
          flex: 1 1 220px;
          display: flex;
          flex-direction: column;
          gap: 6px;
        }

        .package-install-label {
          font-size: 12px;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.06em;
          color: rgba(0, 0, 0, 0.55);
        }

        body.dark .package-install-label {
          color: rgba(255, 255, 255, 0.65);
        }

        .package-install-input {
          border-radius: 8px;
          border: 1px solid rgba(0, 0, 0, 0.14);
          padding: 10px 12px;
          font-size: 14px;
          background: rgba(255, 255, 255, 0.95);
          color: rgba(15, 23, 42, 0.95);
          transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        body.dark .package-install-input {
          background: rgba(15, 23, 42, 0.85);
          border-color: rgba(148, 163, 184, 0.3);
          color: rgba(226, 232, 240, 0.92);
        }

        .package-install-input:focus {
          outline: none;
          border-color: rgba(59, 130, 246, 0.6);
          box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        body.dark .package-install-input:focus {
          border-color: rgba(96, 165, 250, 0.7);
          box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.25);
        }

        .package-install-submit {
          flex: 0 0 auto;
          display: inline-flex;
          align-items: center;
          gap: 8px;
          padding: 11px 18px;
          font-size: 14px;
          font-weight: 600;
          border-radius: 8px;
          border: none;
          cursor: pointer;
          background: rgba(59, 130, 246, 0.9);
          color: #ffffff;
          transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .package-install-submit:hover {
          background: rgba(37, 99, 235, 0.95);
          box-shadow: 0 8px 18px rgba(37, 99, 235, 0.25);
          transform: translateY(-1px);
        }

        .package-install-submit:active {
          transform: translateY(0);
          box-shadow: none;
        }

        .package-install-submit i {
          font-size: 16px;
        }

        .package-install-description {
          margin-top: 12px;
          font-size: 12px;
          color: rgba(0, 0, 0, 0.55);
        }

        body.dark .package-install-description {
          color: rgba(255, 255, 255, 0.55);
        }

        .package-install-description code {
          font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
          background: rgba(15, 23, 42, 0.06);
          padding: 2px 6px;
          border-radius: 6px;
          color: inherit;
        }

        body.dark .package-install-description code {
          background: rgba(255, 255, 255, 0.08);
        }

        @media only screen and (max-width: 720px) {
          .package-install-form {
            flex-direction: column;
            align-items: stretch;
          }

          .package-install-field {
            width: 100%;
          }

          .package-install-submit {
            width: 100%;
            justify-content: center;
          }
        }

        :root {
          --pinokio-modal-bg: #ffffff;
          --pinokio-modal-text: #0f172a;
          --pinokio-modal-title-color: #0f172a;
          --pinokio-modal-subtitle-color: rgba(71, 85, 105, 0.75);
          --pinokio-modal-body-bg: rgba(241, 245, 249, 0.9);
          --pinokio-modal-body-border: rgba(203, 213, 225, 0.7);
          --pinokio-modal-body-iframe-bg: #ffffff;
          --pinokio-modal-label-color: rgba(71, 85, 105, 0.95);
          --pinokio-modal-input-bg: #ffffff;
          --pinokio-modal-input-border: rgba(148, 163, 184, 0.5);
          --pinokio-modal-input-text: #0f172a;
          --pinokio-modal-input-focus-border: rgba(59, 130, 246, 0.6);
          --pinokio-modal-input-focus-shadow: rgba(59, 130, 246, 0.2);
          --pinokio-modern-shadow: 0 32px 80px rgba(15, 23, 42, 0.25);
          --pinokio-modern-close-color: rgba(71, 85, 105, 0.65);
          --pinokio-modern-close-hover-bg: rgba(148, 163, 184, 0.18);
          --pinokio-modern-close-hover-color: #0f172a;
        }

        body.dark {
          --pinokio-modal-bg: #0f172a;
          --pinokio-modal-text: #e2e8f0;
          --pinokio-modal-title-color: #f8fafc;
          --pinokio-modal-subtitle-color: rgba(148, 163, 184, 0.85);
          --pinokio-modal-body-bg: rgba(15, 23, 42, 0.6);
          --pinokio-modal-body-border: rgba(59, 130, 246, 0.18);
          --pinokio-modal-body-iframe-bg: #0b1220;
          --pinokio-modal-label-color: rgba(203, 213, 225, 0.9);
          --pinokio-modal-input-bg: rgba(15, 23, 42, 0.85);
          --pinokio-modal-input-border: rgba(148, 163, 184, 0.25);
          --pinokio-modal-input-text: #f8fafc;
          --pinokio-modal-input-focus-border: rgba(96, 165, 250, 0.7);
          --pinokio-modal-input-focus-shadow: rgba(37, 99, 235, 0.25);
          --pinokio-modern-shadow: 0 40px 120px rgba(2, 8, 23, 0.7);
          --pinokio-modern-close-color: rgba(226, 232, 240, 0.6);
          --pinokio-modern-close-hover-bg: rgba(148, 163, 184, 0.12);
          --pinokio-modern-close-hover-color: #f8fafc;
        }

        .pinokio-modern-modal.swal2-popup {
          background: var(--pinokio-modal-bg) !important;
          color: var(--pinokio-modal-text) !important;
          border-radius: 18px;
          padding: 0 !important;
          box-shadow: var(--pinokio-modern-shadow) !important;
          overflow: hidden;
        }

        .pinokio-modern-html {
          padding: 0 !important;
        }

        .pinokio-modern-close {
          color: var(--pinokio-modern-close-color) !important;
          border-radius: 50%;
          width: 34px;
          height: 34px;
          display: flex !important;
          align-items: center;
          justify-content: center;
          transition: background 0.2s ease, color 0.2s ease;
        }

        .pinokio-modern-close:hover {
          background: var(--pinokio-modern-close-hover-bg) !important;
          color: var(--pinokio-modern-close-hover-color) !important;
        }

        .pinokio-modal-surface {
          display: flex;
          flex-direction: column;
          gap: 0;
          color: var(--pinokio-modal-text);
        }

        .pinokio-modal-header {
          display: flex;
          align-items: center;
          gap: 16px;
          padding: 22px;
        }

        .pinokio-modal-icon {
          width: 48px;
          height: 48px;
          border-radius: 16px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 22px;
          background: rgba(59, 130, 246, 0.12);
          color: rgba(37, 99, 235, 0.95);
        }

        body.dark .pinokio-modal-icon {
          background: rgba(59, 130, 246, 0.18);
          color: rgba(147, 197, 253, 0.95);
        }

        .pinokio-modal-heading {
          text-align: left;
          flex: 1;
          display: flex;
          flex-direction: column;
          gap: 6px;
        }

        .pinokio-modal-title {
          font-size: 20px;
          font-weight: 700;
          color: var(--pinokio-modal-title-color);
        }

        .pinokio-modal-subtitle {
          font-size: 13px;
          color: var(--pinokio-modal-subtitle-color);
          line-height: 1.4;
        }

        .pinokio-modal-subtitle code {
          font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
          font-size: 12px;
          padding: 2px 6px;
          border-radius: 6px;
          background: rgba(15, 23, 42, 0.08);
          color: inherit;
        }

        body.dark .pinokio-modal-subtitle code {
          background: rgba(15, 23, 42, 0.4);
        }

        .pinokio-modal-body {
          background: var(--pinokio-modal-body-bg);
          border-top: 1px solid var(--pinokio-modal-body-border);
          padding: 10px;
        }

        .pinokio-modal-body--iframe {
          height: 520px;
          background: var(--pinokio-modal-body-iframe-bg);
        }

        .pinokio-modal-body--iframe iframe {
          width: 100%;
          height: 100%;
          border: none;
          background: transparent;
        }

        main {
          display: flex;
        }

        aside {
          width: 200px;
          display: block;
          flex-shrink: 0;
        }

        aside .tab i {
          width: 20px;
          text-align: center;
        }

        body.dark aside .tab {
          color: white;
        }

        body.dark aside .tab:hover,
        aside .tab:hover {
          color: rgba(127, 91, 243, 0.9) !important;
          opacity: 1;
        }

        aside .tab {
          display: flex;
          align-items: center;
          gap: 5px;
          color: black;
          text-decoration: none;
          padding: 10px;
          font-size: 12px;
          opacity: 0.5;
          border-left: 10px solid transparent;
        }

        body.dark aside .tab.selected {
          color: white;
        }

        aside .selected {
          font-weight: bold;
          opacity: 1;
        }

        @media only screen and (max-width: 600px) {
          .bundle-header {
            display: block;
          }

          .bundle-status {
            margin-top: 10px;
          }

          .bundles-grid {
            grid-template-columns: minmax(0, 1fr);
          }

          aside {
            width: unset;
            flex-shrink: unset;
          }

          aside {
            padding: 0 10px;
          }

          aside .tab i {
            width: 100%;
          }

          aside .tab .caption {
            display: none;
          }

          aside .tab {
            margin: 0;
            padding: 10px;
            border-left: none;
          }

          aside .btn-tab {
            flex-direction: column;
            padding: 10px 0;
          }

          aside .btn-tab .btn {
            display: flex;
            justify-content: center;
          }

          aside .btn-tab .btn .caption {
            display: none;
          }

          header .flexible {
            min-width: unset;
          }
        }

        @media only screen and (max-width: 480px) {
          .btn2 {
            padding: 5px;
            font-size: 11px;
          }

          .nav-btns {
            flex-grow: 1;
            justify-content: center;
            padding: 0;
          }
        }

        /*
@media only screen and (max-width: 800px) {
  body {
    display: flex !important;
    flex-direction: row !important;
  }
}
*/
        @media only screen and (max-width: 600px) {
          aside {
            width: unset;
            flex-shrink: unset;
          }

          aside {
            padding: 0 10px;
          }

          aside .tab.submenu {
            padding: 10px;
          }

          aside .tab i {
            width: 100%;
          }

          aside .tab .caption {
            display: none;
          }

          aside .tab {
            margin: 0;
            padding: 10px;
            border-left: none;
          }

          aside .btn-tab {
            flex-direction: column;
            padding: 10px 0;
          }

          aside .btn-tab .btn {
            display: flex;
            justify-content: center;
          }

          aside .btn-tab .btn .caption {
            display: none;
          }

          header .flexible {
            min-width: unset;
          }
        }
      </style>
      <script src="/window_storage.js"></script>
      <script src="/popper.min.js"></script>
      <script src="/tippy-bundle.umd.min.js"></script>
      <script src="/hotkeys.min.js"></script>
      <script src="/sweetalert2.js"></script>
      <script src="/noty.js"></script>
      <script src="/notyq.js"></script>
      <script src="/xterm.js"></script>
      <script src="/xterm-addon-fit.js"></script>
      <script src="/xterm-addon-web-links.js"></script>
      <script src="/xterm-theme.js"></script>
      <script src="/install.js"></script>
      <script src="/timeago.min.js"></script>
      <script src="/common.js"></script>
      <script src="/opener.js"></script>
      <script src="/nav.js"></script>
      <script src="/urldropdown.js"></script>
      <script>
        // Initialize URL Dropdown with empty behavior for tools page
        document.addEventListener('DOMContentLoaded', function () {
          initUrlDropdown({
            clearBehavior: 'empty'
          });
        });
      </script>
      <script src="/ui_service.js"></script>
      <script src="/report.js"></script>
</head>

<body class='<%=theme%>' data-agent="<%=agent%>">
  <!--
<nav>
  <a class='logo' href="/home">dal</a>
</nav>
  -->
  <header class='navheader grabbable'>
    <h1>
      <span class="sr-only">Installed Tools</span>
      <a class='home' href="/home" aria-label="Pinokio Home"><img class='icon' src="/pinokio-black.png"
          alt="Pinokio"></a>
      <button class='btn2' id='minimize-header' data-tippy-content="fullscreen" title='fullscreen'
        aria-label="Toggle Fullscreen">
        <div><i class="fa-solid fa-expand"></i></div>
      </button>
      <button class='btn2' id='back' data-tippy-content="back" aria-label="Go Back">
        <div><i class="fa-solid fa-chevron-left"></i></div>
      </button>
      <button class='btn2' id='forward' data-tippy-content="forward" aria-label="Go Forward">
        <div><i class="fa-solid fa-chevron-right"></i></div>
      </button>
      <button class='btn2' id='refresh-page' data-tippy-content="refresh" aria-label="Refresh Page">
        <div><i class="fa-solid fa-rotate-right"></i></div>
      </button>
      <button class='btn2' id='screenshot' data-tippy-content="screen capture" aria-label="Capture Screenshot"><i
          class="fa-solid fa-camera"></i></button>
      <button class='btn2' id='inspector' data-tippy-content="X-ray mode" aria-label="Inspect Element"><i
          class="fa-solid fa-eye"></i></button>
      <button class='btn2 mobile-link-button' id='mobile-link-button' data-tippy-content="enter url"
        aria-label="Enter URL"><i class="fa-solid fa-link"></i></button>
      <div class='mobile-flexible'></div>
      <form class='urlbar'>
        <div class='url-input-container'>
          <input type='url' placeholder='enter any local url to open in pinokio' aria-label="Global Search or URL">
          <div class='url-dropdown' id='url-dropdown'></div>
        </div>
      </form>
      <a class='btn2' href="/columns" data-tippy-content="split into 2 columns" aria-label="Split Columns">
        <div><i class="fa-solid fa-table-columns"></i></div>
      </a>
      <a class='btn2' href="/rows" data-tippy-content="split into 2 rows" aria-label="Split Rows">
        <div><i class="fa-solid fa-table-columns fa-rotate-270"></i></div>
      </a>
      <button class='btn2' id='new-window' data-tippy-content="open a new window" title='open a new window'
        data-agent="<%=agent%>" aria-label="Open New Window">
        <div><i class="fa-solid fa-plus"></i></div>
      </button>
      <button class='btn2 hidden' id='close-window' data-tippy-content='close this section' aria-label="Close Window">
        <div><i class="fa-solid fa-xmark"></i></div>
      </button>
    </h1>
  </header>
  <main class="fade-in">
    <div class='container'>
      <div class='config'>
        <div class='config-header'>
          <div class='header-label'><i class="fa-solid fa-toolbox"></i> Installed Tools</div>
          <div class='desc'>Package managers and their installed modules.</div>
        </div>
      </div>
      <div class='menu-container'>
        <% if (pending) { %>
          <div class="loading-container">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading installed tools...</div>
            <div class="loading-subtext">Scanning package managers and modules</div>
          </div>
          <% } else { %>
            <div class="bundles-section">
              <div class="bundles-header">
                <h3>Package Bundles</h3>
              </div>
              <div class="bundles-grid">
                <% bundles.forEach((bundle)=> { %>
                  <div class="bundle-card <%= !bundle.install_required ? 'installed' : 'pending' %>">
                    <div class="bundle-header">
                      <div class="bundle-title-section">
                        <div class="bundle-icon">
                          <i class="<%= bundle.icon %>"></i>
                        </div>
                        <div class="bundle-title-text">
                          <div class="bundle-name">
                            <%= bundle.title %>
                          </div>
                          <div class="bundle-code">(<%= bundle.name %>)</div>
                        </div>
                      </div>
                      <div class="bundle-status <%= !bundle.install_required ? 'installed' : 'pending' %>">
                        <%= !bundle.install_required ? 'Installed' : 'Not installed' %>
                      </div>
                    </div>

                    <div class="bundle-description">
                      <%= bundle.description %>
                    </div>

                    <div class="bundle-packages">
                      <div class="bundle-packages-title">Included packages:</div>
                      <div class="bundle-packages-list">
                        <% bundle.requirements.forEach((req)=> { %>
                          <span class="package-badge <%= req.installed ? 'installed' : 'not-installed' %>">
                            <span class="package-badge-icon">
                              <%= req.installed ? '✓' : '✗' %>
                            </span>
                            <%= req.name %>
                          </span>
                          <% }) %>
                      </div>
                    </div>

                    <% if (bundle.install_required) { %>
                      <a href="<%= bundle.setup %>" class="bundle-install-btn">Install Bundle</a>
                      <% } %>
                  </div>
                  <% }) %>
              </div>
            </div>

            <div class="package-tabs">
              <% installs.forEach((install, index)=> { %>
                <button class="package-tab <%= index === 0 ? 'active' : '' %>"
                  data-tab="<%= install.package_manager %>">
                  <%= install.package_manager.toUpperCase() %> (<%= install.modules.length %>)
                </button>
                <% }) %>
            </div>

            <% installs.forEach((install, index)=> { %>
              <div class="tab-panel <%= index === 0 ? 'active' : '' %>" id="<%= install.package_manager %>-panel">
                <div class="section-header">
                  <h2>
                    <%= install.package_manager.toUpperCase() %>
                  </h2>
                  <div class="section">
                    <div>
                      <%= install.modules.length %> modules installed
                    </div>
                  </div>
                </div>
                <div class="package-install-card">
                  <form class="package-install-form" data-manager="<%= install.package_manager %>">
                    <% if (install.package_manager==='conda' ) { %>
                      <div class="package-install-field">
                        <label class="package-install-label"
                          for="install-channel-<%= install.package_manager %>">Channel</label>
                        <input id="install-channel-<%= install.package_manager %>" class="package-install-input"
                          name="channel" type="text" value="conda-forge" placeholder="Enter channel" autocomplete="off">
                      </div>
                      <div class="package-install-field">
                        <label class="package-install-label" for="install-name-<%= install.package_manager %>">Package
                          name</label>
                        <input id="install-name-<%= install.package_manager %>" class="package-install-input"
                          name="name" type="text" placeholder="Enter package name" autocomplete="off" required>
                      </div>
                      <% } else { %>
                        <div class="package-install-field">
                          <label class="package-install-label" for="install-name-<%= install.package_manager %>">Package
                            name</label>
                          <input id="install-name-<%= install.package_manager %>" class="package-install-input"
                            name="name" type="text" placeholder="Enter package name" autocomplete="off" required>
                        </div>
                        <% } %>
                          <button type="submit" class="package-install-submit">
                            <i class="fa-solid fa-terminal"></i>
                            <span>Install</span>
                          </button>
                  </form>
                  <div class="package-install-description">
                    <% if (install.package_manager==='conda' ) { %>
                      Runs <code>conda install -y --channel &lt;channel&gt; &lt;name&gt;</code>
                      <% } else if (install.package_manager==='brew' ) { %>
                        Runs <code>brew install &lt;name&gt;</code>
                        <% } else { %>
                          Runs <code><%= install.package_manager %> install &lt;name&gt;</code>
                          <% } %>
                  </div>
                </div>
                <div class='tab-content'>
                  <% install.modules.forEach((module)=> { %>
                    <div class="tab">
                      <div class='emoji'><i class="fa-solid fa-cube"></i></div>
                      <div class='col'>
                        <h2>
                          <%= module %>
                        </h2>
                      </div>
                    </div>
                    <% }) %>
                </div>
              </div>
              <% }) %>
                <% } %>
      </div>
    </div>
    <aside>
      <div class='btn-tab'>
        <button type='button' class='btn' id='create-launcher-button'><i class="fa-solid fa-plus"></i>
          <div class='caption'>Create</div>
        </button>
        <a class='btn' id='explore' href="/home?mode=explore"><i class="fa-solid fa-globe"></i>
          <div class='caption'>Discover</div>
        </a>
      </div>
      <a href="/home" class='tab'><i class='fas fa-laptop-code'></i>
        <div class='caption'>This machine</div>
      </a>
      <a href="/network" class='tab'><i class="fa-solid fa-wifi"></i>
        <div class='caption'>Local network</div>
      </a>
      <% if (list.length> 0) { %>
        <% let brands={ win32: "windows" , darwin: "apple" , linux: "Linux" } %>
          <% list.forEach(({ host, name, platform, processes }, index)=> { %>
            <a href="/net/<%=name%>" class='submenu tab'><i class="fa-brands fa-<%=brands[platform]%>"></i>
              <div class='caption'>
                <%=name%> (<%=current_host===host ? 'this machine' : host%>)
              </div>
            </a>
            <% }) %>
              <% } %>
                <a href="/connect" class='tab'><i class="fa-solid fa-plug"></i>
                  <div class='caption'>Login</div>
                </a>
                <a class='tab' href="<%=portal%>" target="_blank"><i class="fa-solid fa-question"></i>
                  <div class='caption'>Help</div>
                </a>
                <a class='tab' id='genlog' href="/logs"><i class="fa-solid fa-laptop-code"></i>
                  <div class='caption'>Logs</div>
                </a>
                <a class='tab' href="/checkpoints"><i class="fa-solid fa-clock-rotate-left"></i>
                  <div class='caption'>Checkpoints</div>
                </a>
                <a class='tab' href="/screenshots"><i class="fa-solid fa-camera"></i>
                  <div class='caption'>Screenshots</div>
                </a>
                <a class='tab selected' href="/tools"><i class="fa-solid fa-toolbox"></i>
                  <div class='caption'>Installed Tools</div>
                </a>
                <a class='tab' href="/agents"><i class="fa-solid fa-robot"></i>
                  <div class='caption'>Agents</div>
                </a>
                <a class='tab' href="/home?mode=settings"><i class="fa-solid fa-gear"></i>
                  <div class='caption'>Settings</div>
                </a>
                <%- include('partials/peer_access_points', { peer_access_points, peer_url, peer_qr }) %>
    </aside>
  </main>
  <script>
    const PACKAGE_MANAGER_ICONS = {
      conda: 'fa-solid fa-flask',
      brew: 'fa-solid fa-beer-mug-empty',
      pip: 'fa-brands fa-python',
      npm: 'fa-brands fa-npm',
      yarn: 'fa-brands fa-yarn',
      cargo: 'fa-solid fa-box-open'
    };

    const escapeHtml = (value) => {
      if (!value) return '';
      return value
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    };

    const toDisplayName = (manager) => {
      if (!manager) return 'Package Manager';
      return manager
        .split(/[\s_-]+/)
        .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
    };

    const buildInstallPayload = (manager, formData) => {
      const trimmedManager = (manager || '').trim();
      const normalizedManager = trimmedManager.toLowerCase();
      const name = (formData.get('name') || '').trim();
      if (!normalizedManager || !name) {
        return null;
      }

      if (normalizedManager === 'conda') {
        let channel = (formData.get('channel') || '').trim();
        if (!channel) {
          channel = 'conda-forge';
        }
        return {
          manager: normalizedManager,
          command: `conda install -y --channel ${channel} ${name}`,
          name,
          channel
        };
      }

      if (normalizedManager === 'brew') {
        return {
          manager: normalizedManager,
          command: `brew install ${name}`,
          name
        };
      }

      return {
        manager: normalizedManager,
        command: `${normalizedManager} install ${name}`,
        name
      };
    };

    const openPackageInstallModal = ({ manager, command, name, channel }) => {
      if (typeof Swal === 'undefined') {
        console.error('SweetAlert2 is not available.');
        return;
      }

      const icon = PACKAGE_MANAGER_ICONS[manager] || 'fa-solid fa-box-open';
      const displayName = toDisplayName(manager);
      const safeName = escapeHtml(name);
      const safeChannel = channel ? escapeHtml(channel) : null;
      const commandHtml = escapeHtml(command);
      const detailParts = [];
      if (safeChannel) {
        detailParts.push(`Channel: ${safeChannel}`);
      }
      if (safeName) {
        detailParts.push(`Package: ${safeName}`);
      }
      const detailsHtml = detailParts.join(' · ');

      const sanitizedManager = (manager || 'pkg').replace(/[^a-z0-9_-]/gi, '-').toLowerCase();
      const shellId = encodeURIComponent(`pkg-install-${sanitizedManager}-${Date.now()}`);
      const params = new URLSearchParams();
      params.set('path', '~/');
      params.set('message', command);
      params.set('target', '_top');
      const shellUrl = `/shell/${shellId}?${params.toString()}`;

      const modalHtml = `
    <div class="pinokio-modal-surface">
      <div class="pinokio-modal-header">
        <div class="pinokio-modal-icon"><i class="${icon}"></i></div>
        <div class="pinokio-modal-heading">
          <div class="pinokio-modal-title">${escapeHtml(displayName)} install</div>
          <div class="pinokio-modal-subtitle">
            ${detailsHtml ? `${detailsHtml} · ` : ''}Running <code>${commandHtml}</code>
          </div>
        </div>
      </div>
      <div class="pinokio-modal-body pinokio-modal-body--iframe">
        <iframe src="${shellUrl}"></iframe>
      </div>
    </div>
  `;

      Swal.fire({
        html: modalHtml,
        customClass: {
          popup: 'pinokio-modern-modal',
          htmlContainer: 'pinokio-modern-html',
          closeButton: 'pinokio-modern-close'
        },
        backdrop: 'rgba(9,11,15,0.65)',
        width: 'min(760px, 90vw)',
        showConfirmButton: false,
        showCloseButton: true,
        buttonsStyling: false,
        focusConfirm: false
      });
    };

    const registerPackageInstallForms = () => {
      const forms = document.querySelectorAll('.package-install-form');
      forms.forEach((form) => {
        form.addEventListener('submit', (event) => {
          event.preventDefault();
          if (typeof form.reportValidity === 'function' && !form.reportValidity()) {
            return;
          }

          const manager = (form.dataset.manager || '').toLowerCase();
          const formData = new FormData(form);
          const payload = buildInstallPayload(manager, formData);
          if (!payload) {
            const nameInput = form.querySelector('input[name="name"]');
            if (nameInput) {
              nameInput.focus();
            }
            return;
          }

          openPackageInstallModal(payload);
          form.reset();
          if (manager === 'conda') {
            const channelInput = form.querySelector('input[name="channel"]');
            if (channelInput && !channelInput.value) {
              channelInput.value = 'conda-forge';
            }
          }
        });
      });
    };

    document.addEventListener('DOMContentLoaded', function () {
      const isPending = <%= pending ? 'true' : 'false' %>;

      // Auto-refresh when pending
      if (isPending) {
        setTimeout(function () {
          window.location.reload();
        }, 3000);
      }

      // Tab functionality (only when not pending)
      if (!isPending) {
        const tabs = document.querySelectorAll('.package-tab');
        const panels = document.querySelectorAll('.tab-panel');

        registerPackageInstallForms();

        tabs.forEach(tab => {
          tab.addEventListener('click', function () {
            const targetTab = this.getAttribute('data-tab');

            // Remove active class from all tabs and panels
            tabs.forEach(t => t.classList.remove('active'));
            panels.forEach(p => p.classList.remove('active'));

            // Add active class to clicked tab
            this.classList.add('active');

            // Show corresponding panel
            const targetPanel = document.getElementById(targetTab + '-panel');
            if (targetPanel) {
              targetPanel.classList.add('active');
            }
          });
        });
      }
    });
  </script>
</body>

</html>